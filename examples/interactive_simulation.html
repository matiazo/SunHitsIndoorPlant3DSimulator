<!DOCTYPE html>
<html>
<head>
    <title>Sun-Plant Simulation</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .time-display {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .status {
            font-size: 24px;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 15px;
        }
        .status.hit {
            background: #4CAF50;
            color: white;
        }
        .status.miss {
            background: #9E9E9E;
            color: white;
        }
        .info {
            color: #666;
            font-size: 14px;
        }
        .slider-container {
            margin: 20px 0;
        }
        #timeSlider {
            width: 100%;
            height: 30px;
            cursor: pointer;
        }
        .plot-container {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .legend {
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .legend-item {
            display: inline-block;
            margin-right: 20px;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sun Hits Indoor Plant - 3D Simulation</h1>
        <h2 style="color: #666; margin-top: 0;">Date: 2026-01-26</h2>

        <div class="controls">
            <div class="time-display">Time: <span id="currentTime">--:--</span></div>
            <div id="statusDisplay" class="status miss">Loading...</div>
            <div class="info">
                <span id="sunInfo">Sun: Az --°, El --°</span>
                <span id="windowInfo" style="margin-left: 20px;"></span>
            </div>

            <div class="slider-container">
                <input type="range" id="timeSlider" min="0" max="135" value="0">
            </div>

            <div class="legend">
                <span class="legend-item"><span class="legend-color" style="background: #90EE90;"></span> Wall 1 windows</span>
                <span class="legend-item"><span class="legend-color" style="background: #87CEEB;"></span> Wall 2 windows</span>
                <span class="legend-item"><span class="legend-color" style="background: #FFC832;"></span> Window receiving sun</span>
                <span class="legend-item"><span class="legend-color" style="background: #228B22;"></span> Plant</span>
                <span class="legend-item"><span class="legend-color" style="background: #FFD700;"></span> Sun rays through window</span>
                <span class="legend-item"><span class="legend-color" style="background: #FF4500;"></span> Ray hitting plant</span>
            </div>
        </div>

        <div class="plot-container">
            <div id="plot3d" style="width: 100%; height: 700px;"></div>
        </div>
    </div>

    <script>
        const config = {"plant": {"center_x": 5.5, "center_y": 10, "radius": 0.3, "z_min": 0.0, "z_max": 1.2}, "windows": [{"id": "window_1a", "center": [2.0, 0.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 210}, {"id": "window_1b", "center": [5.0, 0.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 210}, {"id": "window_1c", "center": [8.0, 0.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 210}, {"id": "window_1d", "center": [11.0, 0.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 210}, {"id": "window_2a", "center": [0.0, 2.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 300}, {"id": "window_2b", "center": [0.0, 5.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 300}, {"id": "window_2c", "center": [0.0, 8.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 300}, {"id": "window_2d", "center": [0.0, 11.0, 4.75], "width": 1.5, "height": 1.5, "wall_normal_azimuth": 300}]};
        const results = [{"timestamp": "07:00", "azimuth": 109.4, "elevation": -4.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "07:05", "azimuth": 110.0, "elevation": -3.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "07:10", "azimuth": 110.6, "elevation": -2.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "07:15", "azimuth": 111.1, "elevation": -1.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "07:20", "azimuth": 111.7, "elevation": 0.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9291311563845823, -0.3697461941174565, 0.0017453283658983088]}, {"timestamp": "07:25", "azimuth": 112.3, "elevation": 1.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9250392134497467, -0.3793862303584364, 0.01919744239968967]}, {"timestamp": "07:30", "azimuth": 112.9, "elevation": 2.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9205667317163321, -0.38886261207441836, 0.036643708706556276]}, {"timestamp": "07:35", "azimuth": 113.5, "elevation": 3.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9157181131656298, -0.39816556758029237, 0.05407881298477529]}, {"timestamp": "07:40", "azimuth": 114.2, "elevation": 4.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9097858028019354, -0.4088739518163662, 0.07149744433268591]}, {"timestamp": "07:45", "azimuth": 114.8, "elevation": 5.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.9041836468738202, -0.4177914990884563, 0.08889429686644151]}, {"timestamp": "07:50", "azimuth": 115.4, "elevation": 6.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8982205579686608, -0.42650647871458586, 0.1062640713362332]}, {"timestamp": "07:55", "azimuth": 116.1, "elevation": 7.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8911414445291392, -0.4365656889748534, 0.1236014767404927]}, {"timestamp": "08:00", "azimuth": 116.7, "elevation": 8.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8844588095716449, -0.4448364384912506, 0.14090123193758267]}, {"timestamp": "08:05", "azimuth": 117.4, "elevation": 9.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8766411691295606, -0.45440762135937307, 0.15815806725448353]}, {"timestamp": "08:10", "azimuth": 118.1, "elevation": 10.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8684567047352777, -0.46371269486625083, 0.1753667260919871]}, {"timestamp": "08:15", "azimuth": 118.8, "elevation": 11.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8602064581678311, -0.47290250222403035, 0.1908089953765448]}, {"timestamp": "08:20", "azimuth": 119.5, "elevation": 12.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8513363357686146, -0.4816629238600052, 0.20791169081775934]}, {"timestamp": "08:25", "azimuth": 120.2, "elevation": 12.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8424615380617748, -0.4903243238792926, 0.22325011601095138]}, {"timestamp": "08:30", "azimuth": 120.9, "elevation": 13.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8329377462497781, -0.49850295734316585, 0.24022804247726373]}, {"timestamp": "08:35", "azimuth": 121.7, "elevation": 14.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8225840798756806, -0.5080382823052702, 0.25544575793579055]}, {"timestamp": "08:40", "azimuth": 122.4, "elevation": 15.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8124275223572928, -0.5155821835439182, 0.27228024704057435]}, {"timestamp": "08:45", "azimuth": 123.2, "elevation": 16.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.8014716823147898, -0.5244683728111771, 0.28736051984971195]}, {"timestamp": "08:50", "azimuth": 124.0, "elevation": 17.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.790230877409184, -0.533017457084358, 0.3023698907504445]}, {"timestamp": "08:55", "azimuth": 124.8, "elevation": 18.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7787152194753542, -0.5412211765822708, 0.31730465640509214]}, {"timestamp": "09:00", "azimuth": 125.6, "elevation": 19.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7669350610139946, -0.5490715751641104, 0.3321611318837033]}, {"timestamp": "09:05", "azimuth": 126.4, "elevation": 20.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7549009860778629, -0.5565610073353239, 0.34693565157325584]}, {"timestamp": "09:10", "azimuth": 127.2, "elevation": 21.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7426238009541991, -0.5636821449800233, 0.3616245700820923]}, {"timestamp": "09:15", "azimuth": 128.1, "elevation": 22.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7291178284829372, -0.5717014045929637, 0.37622426313936563]}, {"timestamp": "09:20", "azimuth": 129.0, "elevation": 22.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7158955176885022, -0.5797207596600227, 0.38912395014020623]}, {"timestamp": "09:25", "azimuth": 129.9, "elevation": 23.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.7019251724908868, -0.5869005418429092, 0.40354529635239006]}, {"timestamp": "09:30", "azimuth": 130.8, "elevation": 24.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.688287238968672, -0.5941136075431489, 0.4162807922604012]}, {"timestamp": "09:35", "azimuth": 131.7, "elevation": 25.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.6744646210576966, -0.6009260572432544, 0.4289351334031458]}, {"timestamp": "09:40", "azimuth": 132.7, "elevation": 26.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.6594082714941223, -0.6084844397647057, 0.4415058527917452]}, {"timestamp": "09:45", "azimuth": 133.6, "elevation": 27.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.6446670637907083, -0.6139081481435757, 0.4555449072335156]}, {"timestamp": "09:50", "azimuth": 134.6, "elevation": 27.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.6298446941412559, -0.6211112323687091, 0.4663866403398912]}, {"timestamp": "09:55", "azimuth": 135.6, "elevation": 28.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.6142925015018051, -0.6272948491260109, 0.4786918579406068]}, {"timestamp": "10:00", "azimuth": 136.6, "elevation": 29.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.5986001288610057, -0.6330018881600216, 0.49090375361514077]}, {"timestamp": "10:05", "azimuth": 137.7, "elevation": 30.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.5822577321241681, -0.63989289251827, 0.5015107371594574]}, {"timestamp": "10:10", "azimuth": 138.8, "elevation": 30.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.5651983094978938, -0.6456208278666744, 0.51354125205817]}, {"timestamp": "10:15", "azimuth": 139.9, "elevation": 31.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.5486174443857573, -0.6515041596646609, 0.5239859059700791]}, {"timestamp": "10:20", "azimuth": 141.0, "elevation": 32.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.531940507422681, -0.6568918200620812, 0.5343523493898262]}, {"timestamp": "10:25", "azimuth": 142.1, "elevation": 33.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.5151829176474493, -0.6617815975850051, 0.5446390350150271]}, {"timestamp": "10:30", "azimuth": 143.3, "elevation": 33.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.49777467889840643, -0.667815964374647, 0.5533915492433441]}, {"timestamp": "10:35", "azimuth": 144.5, "elevation": 34.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.47971772132145657, -0.67253944123669, 0.5635260489375714]}, {"timestamp": "10:40", "azimuth": 145.7, "elevation": 34.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.4621769461398844, -0.6775260658868245, 0.5721458734455162]}, {"timestamp": "10:45", "azimuth": 147.0, "elevation": 35.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.44339909030834446, -0.6827747241530775, 0.5807029557109398]}, {"timestamp": "10:50", "azimuth": 148.2, "elevation": 36.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.42577495202275495, -0.6867046983322406, 0.5891963573533421]}, {"timestamp": "10:55", "azimuth": 149.5, "elevation": 36.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.4069318979412387, -0.6908332752122093, 0.5976251469755212]}, {"timestamp": "11:00", "azimuth": 150.8, "elevation": 37.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.38859481430108705, -0.6953085506492327, 0.6045991148623748]}, {"timestamp": "11:05", "azimuth": 152.2, "elevation": 37.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.36851774156962347, -0.6989560914183749, 0.6129070536529764]}, {"timestamp": "11:10", "azimuth": 153.5, "elevation": 38.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.3501655003121148, -0.7023233401633788, 0.61977903179514]}, {"timestamp": "11:15", "azimuth": 154.9, "elevation": 38.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.3310581282858691, -0.7067334266851457, 0.6252426563357052]}, {"timestamp": "11:20", "azimuth": 156.3, "elevation": 39.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.31148721426643455, -0.7095876802210693, 0.6320293026648509]}, {"timestamp": "11:25", "azimuth": 157.7, "elevation": 39.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.2923759959699411, -0.7128863403611035, 0.6374239897486897]}, {"timestamp": "11:30", "azimuth": 159.2, "elevation": 40.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.2720277152656133, -0.7161180146881069, 0.6427876096865393]}, {"timestamp": "11:35", "azimuth": 160.6, "elevation": 40.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.2529534262042025, -0.7183001865637183, 0.6481199010631309]}, {"timestamp": "11:40", "azimuth": 162.1, "elevation": 40.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.23266743999630074, -0.7203522587226152, 0.6534206039901054]}, {"timestamp": "11:45", "azimuth": 163.6, "elevation": 41.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.21276218600590455, -0.7229038929367728, 0.6573752457940958]}, {"timestamp": "11:50", "azimuth": 165.2, "elevation": 41.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.1916126907177793, -0.7252249261698365, 0.6613118653236518]}, {"timestamp": "11:55", "azimuth": 166.7, "elevation": 41.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.1720307541889538, -0.7277413027762202, 0.6639262126522416]}, {"timestamp": "12:00", "azimuth": 168.2, "elevation": 41.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.15220877254452933, -0.728582299684462, 0.6678325554710466]}, {"timestamp": "12:05", "azimuth": 169.8, "elevation": 42.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.13139259912257123, -0.7302493639074864, 0.6704266189587991]}, {"timestamp": "12:10", "azimuth": 171.4, "elevation": 42.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.11060098980927344, -0.7313149647808844, 0.6730125135097732]}, {"timestamp": "12:15", "azimuth": 173.0, "elevation": 42.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.08999506749610103, -0.7329510064972026, 0.6743023875837234]}, {"timestamp": "12:20", "azimuth": 174.6, "elevation": 42.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.0692728553075097, -0.7328302621915272, 0.6768759696826607]}, {"timestamp": "12:25", "azimuth": 176.2, "elevation": 42.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.048784025036503816, -0.7344787543335719, 0.6768759696826607]}, {"timestamp": "12:30", "azimuth": 177.8, "elevation": 42.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.02821176117424863, -0.7343729016622799, 0.6781596698680706]}, {"timestamp": "12:35", "azimuth": 179.4, "elevation": 42.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [0.007695866984288496, -0.7348742993164135, 0.6781596698680706]}, {"timestamp": "12:40", "azimuth": 181.0, "elevation": 42.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.012826028211248858, -0.7348026640974799, 0.6781596698680706]}, {"timestamp": "12:45", "azimuth": 182.6, "elevation": 42.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.03333792205580277, -0.7341580518644679, 0.6781596698680706]}, {"timestamp": "12:50", "azimuth": 184.2, "elevation": 42.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.0539104235715504, -0.7341202816272642, 0.6768759696826607]}, {"timestamp": "12:55", "azimuth": 185.8, "elevation": 42.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.07450651765493531, -0.7335029994490575, 0.6755902076156602]}, {"timestamp": "13:00", "azimuth": 187.4, "elevation": 42.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.09510979614179792, -0.7323048660064713, 0.6743023875837234]}, {"timestamp": "13:05", "azimuth": 189.0, "elevation": 42.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.1157037946700989, -0.7305250088519878, 0.6730125135097732]}, {"timestamp": "13:10", "azimuth": 190.6, "elevation": 42.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.13648745806947346, -0.7293142823099017, 0.6704266189587991]}, {"timestamp": "13:15", "azimuth": 192.1, "elevation": 41.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.15602151667369607, -0.7277753528307007, 0.6678325554710466]}, {"timestamp": "13:20", "azimuth": 193.7, "elevation": 41.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.17710711338508178, -0.7265225767597688, 0.6639262126522416]}, {"timestamp": "13:25", "azimuth": 195.2, "elevation": 41.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.1969733261056264, -0.724982280536337, 0.6600016679609367]}, {"timestamp": "13:30", "azimuth": 196.7, "elevation": 41.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.21687373730837364, -0.7228778130126359, 0.6560590289905073]}, {"timestamp": "13:35", "azimuth": 198.2, "elevation": 40.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.23679182611761895, -0.7202064306889643, 0.6520984038303923]}, {"timestamp": "13:40", "azimuth": 199.7, "elevation": 40.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.2570918776898683, -0.7180297678694867, 0.6467897795104595]}, {"timestamp": "13:45", "azimuth": 201.2, "elevation": 40.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.2770204924066762, -0.7142014671087058, 0.6427876096865393]}, {"timestamp": "13:50", "azimuth": 202.6, "elevation": 39.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.2965317182452203, -0.7123716991590905, 0.636078220277764]}, {"timestamp": "13:55", "azimuth": 204.0, "elevation": 39.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.31564651048128284, -0.7089536700955038, 0.6306758074312863]}, {"timestamp": "14:00", "azimuth": 205.4, "elevation": 38.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.3347540208835378, -0.7049903305723952, 0.6252426563357052]}, {"timestamp": "14:05", "azimuth": 206.8, "elevation": 38.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.35432522332876193, -0.7014447181812106, 0.6184083953575542]}, {"timestamp": "14:10", "azimuth": 208.2, "elevation": 37.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.3738932856861825, -0.6973080309593082, 0.6115270401858311]}, {"timestamp": "14:15", "azimuth": 209.5, "elevation": 37.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.39274911771342924, -0.6941817154431613, 0.6032079877452825]}, {"timestamp": "14:20", "azimuth": 210.8, "elevation": 36.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.4110769599650174, -0.689588015744296, 0.5962248749656158]}, {"timestamp": "14:25", "azimuth": 212.1, "elevation": 36.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.42991048161683565, -0.6853360307057074, 0.5877852522924731]}, {"timestamp": "14:30", "azimuth": 213.3, "elevation": 35.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.44752375943949635, -0.6812898121258172, 0.5792811723426788]}, {"timestamp": "14:35", "azimuth": 214.6, "elevation": 34.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.4662844421618748, -0.6759177780312461, 0.5707135676844316]}, {"timestamp": "14:40", "azimuth": 215.8, "elevation": 34.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.4838071297547387, -0.6708151291830116, 0.5620833778521306]}, {"timestamp": "14:45", "azimuth": 217.0, "elevation": 33.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.5018450153135178, -0.665970828827819, 0.5519369853120581]}, {"timestamp": "14:50", "azimuth": 218.1, "elevation": 32.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.5186597498020462, -0.6614712985818432, 0.5417082102827397]}, {"timestamp": "14:55", "azimuth": 219.3, "elevation": 32.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.5359625659733462, -0.6548182971452903, 0.53287627607073]}, {"timestamp": "15:00", "azimuth": 220.4, "elevation": 31.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.552613058963626, -0.6493181477000606, 0.5224985647159488]}, {"timestamp": "15:05", "azimuth": 221.5, "elevation": 30.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.5697553536639317, -0.643991277845897, 0.5105429179116057]}, {"timestamp": "15:10", "azimuth": 222.6, "elevation": 30.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.5861917849564096, -0.6374787770974172, 0.49999999999999994]}, {"timestamp": "15:15", "azimuth": 223.6, "elevation": 29.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.6013960137605365, -0.6315280283195868, 0.48938245174884626]}, {"timestamp": "15:20", "azimuth": 224.7, "elevation": 28.5, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.5, 10.3, 0.0], [5.5, 10.3, 0.6], [5.287867965644036, 10.212132034355964, 0.0], [5.287867965644036, 10.212132034355964, 0.6], [5.287867965644036, 10.212132034355964, 1.2], [5.2, 10.0, 0.0], [5.2, 10.0, 0.6], [5.2, 10.0, 1.2]], "sun_direction": [-0.618155301785648, -0.6246627413107075, 0.4771587602596084]}, {"timestamp": "15:25", "azimuth": 225.7, "elevation": 27.7, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.5, 10.3, 0.0], [5.5, 10.3, 0.6], [5.5, 10.3, 1.2], [5.287867965644036, 10.212132034355964, 0.6], [5.287867965644036, 10.212132034355964, 1.2], [5.2, 10.0, 0.6], [5.2, 10.0, 1.2]], "sun_direction": [-0.63366978442004, -0.6183724418500638, 0.4648420457246196]}, {"timestamp": "15:30", "azimuth": 226.6, "elevation": 26.9, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.712132034355964, 10.212132034355964, 0.0], [5.712132034355964, 10.212132034355964, 0.6], [5.712132034355964, 10.212132034355964, 1.2], [5.5, 10.3, 0.6], [5.5, 10.3, 1.2], [5.287867965644036, 10.212132034355964, 0.6], [5.287867965644036, 10.212132034355964, 1.2], [5.2, 10.0, 0.6], [5.2, 10.0, 1.2], [5.287867965644035, 9.787867965644036, 0.6], [5.287867965644035, 9.787867965644036, 1.2], [5.5, 10.0, 1.2], [5.5, 10.0, 0.6]], "sun_direction": [-0.6479574966456375, -0.6127429447579803, 0.4524347093117827]}, {"timestamp": "15:35", "azimuth": 227.6, "elevation": 26.1, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.8, 10.0, 0.0], [5.8, 10.0, 0.6], [5.8, 10.0, 1.2], [5.712132034355964, 10.212132034355964, 0.6], [5.712132034355964, 10.212132034355964, 1.2], [5.5, 10.3, 0.6], [5.5, 10.3, 1.2], [5.2, 10.0, 1.2], [5.287867965644035, 9.787867965644036, 0.6], [5.287867965644035, 9.787867965644036, 1.2], [5.5, 10.0, 1.2], [5.5, 10.0, 0.6]], "sun_direction": [-0.6631532593497419, -0.6055421384514064, 0.43993916985591514]}, {"timestamp": "15:40", "azimuth": 228.6, "elevation": 25.3, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.8, 10.0, 0.6], [5.8, 10.0, 1.2], [5.712132034355964, 10.212132034355964, 0.6], [5.712132034355964, 10.212132034355964, 1.2], [5.287867965644035, 9.787867965644036, 1.2], [5.5, 9.7, 0.6], [5.5, 9.7, 1.2], [5.712132034355964, 9.787867965644036, 0.6], [5.712132034355964, 9.787867965644036, 1.2], [5.5, 10.0, 1.2]], "sun_direction": [-0.6781623283602795, -0.5978805173227325, 0.4273578633871924]}, {"timestamp": "15:45", "azimuth": 229.5, "elevation": 24.5, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.8, 10.0, 0.6], [5.8, 10.0, 1.2], [5.287867965644035, 9.787867965644036, 1.2], [5.5, 9.7, 1.2], [5.712132034355964, 9.787867965644036, 0.6], [5.712132034355964, 9.787867965644036, 1.2], [5.5, 10.0, 1.2]], "sun_direction": [-0.6919399788395093, -0.5909725714268244, 0.414693242656239]}, {"timestamp": "15:50", "azimuth": 230.4, "elevation": 23.6, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.8, 10.0, 1.2], [5.5, 9.7, 1.2], [5.712132034355964, 9.787867965644036, 1.2]], "sun_direction": [-0.7060696183138749, -0.5841115871345622, 0.40034903255689497]}, {"timestamp": "15:55", "azimuth": 231.3, "elevation": 22.8, "is_hit": true, "window_id": "window_2b", "hit_points": [[5.712132034355964, 9.787867965644036, 1.2]], "sun_direction": [-0.71945003490441, -0.5763881656771989, 0.387515586452103]}, {"timestamp": "16:00", "azimuth": 232.2, "elevation": 21.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7331344666821153, -0.568677384649602, 0.3729877825758089]}, {"timestamp": "16:05", "azimuth": 233.0, "elevation": 21.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7455904800857619, -0.5618427259867126, 0.35836794954530027]}, {"timestamp": "16:10", "azimuth": 233.9, "elevation": 20.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7587786557193118, -0.5533109125456638, 0.3436596945856161]}, {"timestamp": "16:15", "azimuth": 234.7, "elevation": 19.3, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7702714341404988, -0.5453825757727767, 0.3305143927132231]}, {"timestamp": "16:20", "azimuth": 235.5, "elevation": 18.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7819935709514383, -0.5374492910638031, 0.31564903694710245]}, {"timestamp": "16:25", "azimuth": 236.3, "elevation": 17.4, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.7938841748122625, -0.5294549287234044, 0.29904079225608665]}, {"timestamp": "16:30", "azimuth": 237.1, "elevation": 16.5, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8050440959029542, -0.5208063820888786, 0.28401534470392265]}, {"timestamp": "16:35", "azimuth": 237.8, "elevation": 15.6, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8150215818940618, -0.5132464818458617, 0.2689198206152657]}, {"timestamp": "16:40", "azimuth": 238.6, "elevation": 14.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.825612161560564, -0.5039558157650211, 0.2537579445848056]}, {"timestamp": "16:45", "azimuth": 239.3, "elevation": 13.7, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8353887177979196, -0.49601752261805077, 0.23683814606561868]}, {"timestamp": "16:50", "azimuth": 240.0, "elevation": 12.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8445041133126099, -0.4875746771527821, 0.2215484976194673]}, {"timestamp": "16:55", "azimuth": 240.8, "elevation": 11.8, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8544749543695246, -0.4775499106232966, 0.20449605184179034]}, {"timestamp": "17:00", "azimuth": 241.5, "elevation": 10.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8629621206451489, -0.46855020197635633, 0.1890954429898913]}, {"timestamp": "17:05", "azimuth": 242.2, "elevation": 9.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8714089684234639, -0.45944182899281927, 0.17192910027940955]}, {"timestamp": "17:10", "azimuth": 242.8, "elevation": 8.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8787076807699672, -0.4515944066603734, 0.1547103862994681]}, {"timestamp": "17:15", "azimuth": 243.5, "elevation": 7.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8864409541439404, -0.4419631563615038, 0.13744454603714665]}, {"timestamp": "17:20", "azimuth": 244.2, "elevation": 6.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8937980703864256, -0.43207886933790274, 0.1201368388346471]}, {"timestamp": "17:25", "azimuth": 244.8, "elevation": 6.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.8998703151989941, -0.4234468280558562, 0.10452846326765347]}, {"timestamp": "17:30", "azimuth": 245.4, "elevation": 5.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.9057761911462578, -0.4146967181672431, 0.08715574274765817]}, {"timestamp": "17:35", "azimuth": 246.1, "elevation": 4.0, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.9120268785495562, -0.40415468223681167, 0.0697564737441253]}, {"timestamp": "17:40", "azimuth": 246.7, "elevation": 2.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.9172701795831097, -0.3950389500567808, 0.05059294007671331]}, {"timestamp": "17:45", "azimuth": 247.3, "elevation": 1.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.9220308927215418, -0.3856938773342687, 0.033155178388526274]}, {"timestamp": "17:50", "azimuth": 247.9, "elevation": 0.9, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": [-0.9264143273339761, -0.37617784928568315, 0.015707317311820675]}, {"timestamp": "17:55", "azimuth": 248.5, "elevation": -0.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "18:00", "azimuth": 249.1, "elevation": -1.1, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "18:05", "azimuth": 249.7, "elevation": -2.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "18:10", "azimuth": 250.3, "elevation": -3.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}, {"timestamp": "18:15", "azimuth": 250.8, "elevation": -4.2, "is_hit": false, "window_id": null, "hit_points": [], "sun_direction": null}];

        let currentIndex = 0;

        // Room offset - moves room away from origin so sun can be rendered in all directions
        const ROOM_OFFSET_X = 30;
        const ROOM_OFFSET_Y = 30;

        // Check if sun shines into a window based on wall normal azimuth
        // Sun shines through window if sun direction is opposite to outward normal
        function windowReceivesSun(wallNormalAzimuth, sunDir) {
            if (!sunDir) return false;

            // Convert wall normal azimuth to direction vector
            const azRad = wallNormalAzimuth * Math.PI / 180;
            const outwardNormal = [Math.sin(azRad), Math.cos(azRad), 0];

            // Inward normal is opposite of outward
            const inwardNormal = [-outwardNormal[0], -outwardNormal[1], 0];

            // Sun shines through if sun direction has component INTO the room
            // (dot product of sun direction and inward normal > 0)
            // But sun_direction points TOWARD sun, so light comes FROM opposite direction
            // Light direction = -sunDir, so we check if -sunDir dot inwardNormal > 0
            // Which is equivalent to: sunDir dot inwardNormal < 0
            // Or: sunDir dot outwardNormal > 0 (sun is on the outside)
            const dot = sunDir[0] * outwardNormal[0] + sunDir[1] * outwardNormal[1];
            return dot > 0.1;  // Sun is in direction of outward normal (outside the room)
        }

        function createPlotData(index) {
            const result = results[index];
            const traces = [];
            const sunDir = result.sun_direction;

            // Add walls as lines to show room boundary
            // Wall 1 along X-axis (at y=ROOM_OFFSET_Y)
            traces.push({
                type: 'scatter3d',
                mode: 'lines',
                x: [ROOM_OFFSET_X, ROOM_OFFSET_X + 15],
                y: [ROOM_OFFSET_Y, ROOM_OFFSET_Y],
                z: [0, 0],
                line: { color: '#888', width: 4 },
                name: 'Wall 1 (X-axis)',
                showlegend: false,
            });
            traces.push({
                type: 'scatter3d',
                mode: 'lines',
                x: [ROOM_OFFSET_X, ROOM_OFFSET_X + 15],
                y: [ROOM_OFFSET_Y, ROOM_OFFSET_Y],
                z: [6, 6],
                line: { color: '#888', width: 4 },
                name: 'Wall 1 top',
                showlegend: false,
            });

            // Wall 2 along Y-axis (at x=ROOM_OFFSET_X)
            traces.push({
                type: 'scatter3d',
                mode: 'lines',
                x: [ROOM_OFFSET_X, ROOM_OFFSET_X],
                y: [ROOM_OFFSET_Y, ROOM_OFFSET_Y + 15],
                z: [0, 0],
                line: { color: '#888', width: 4 },
                name: 'Wall 2 (Y-axis)',
                showlegend: false,
            });
            traces.push({
                type: 'scatter3d',
                mode: 'lines',
                x: [ROOM_OFFSET_X, ROOM_OFFSET_X],
                y: [ROOM_OFFSET_Y, ROOM_OFFSET_Y + 15],
                z: [6, 6],
                line: { color: '#888', width: 4 },
                name: 'Wall 2 top',
                showlegend: false,
            });

            // Add windows with sun exposure coloring
            config.windows.forEach((w, i) => {
                const isWall1 = w.id.startsWith('window_1');
                const receivesSun = windowReceivesSun(w.wall_normal_azimuth, sunDir);

                // Colors: bright yellow/orange if receiving sun, otherwise default
                let color, frameColor;
                if (receivesSun) {
                    color = 'rgba(255, 200, 50, 0.8)';  // Bright yellow - sun hitting
                    frameColor = '#FF8C00';  // Dark orange frame
                } else {
                    color = isWall1 ? 'rgba(144, 238, 144, 0.4)' : 'rgba(135, 206, 235, 0.4)';
                    frameColor = isWall1 ? '#228B22' : '#4169E1';
                }

                // Window rectangle with offset
                let corners;
                if (isWall1) {
                    // Wall 1: along X-axis, y=ROOM_OFFSET_Y
                    corners = [
                        [ROOM_OFFSET_X + w.center[0] - w.width/2, ROOM_OFFSET_Y, w.center[2] - w.height/2],
                        [ROOM_OFFSET_X + w.center[0] + w.width/2, ROOM_OFFSET_Y, w.center[2] - w.height/2],
                        [ROOM_OFFSET_X + w.center[0] + w.width/2, ROOM_OFFSET_Y, w.center[2] + w.height/2],
                        [ROOM_OFFSET_X + w.center[0] - w.width/2, ROOM_OFFSET_Y, w.center[2] + w.height/2],
                    ];
                } else {
                    // Wall 2: along Y-axis, x=ROOM_OFFSET_X
                    corners = [
                        [ROOM_OFFSET_X, ROOM_OFFSET_Y + w.center[1] - w.width/2, w.center[2] - w.height/2],
                        [ROOM_OFFSET_X, ROOM_OFFSET_Y + w.center[1] + w.width/2, w.center[2] - w.height/2],
                        [ROOM_OFFSET_X, ROOM_OFFSET_Y + w.center[1] + w.width/2, w.center[2] + w.height/2],
                        [ROOM_OFFSET_X, ROOM_OFFSET_Y + w.center[1] - w.width/2, w.center[2] + w.height/2],
                    ];
                }

                // Window mesh
                traces.push({
                    type: 'mesh3d',
                    x: corners.map(c => c[0]),
                    y: corners.map(c => c[1]),
                    z: corners.map(c => c[2]),
                    i: [0, 0],
                    j: [1, 2],
                    k: [2, 3],
                    color: color,
                    name: w.id,
                    showlegend: false,
                });

                // Window frame
                const frameX = [...corners.map(c => c[0]), corners[0][0]];
                const frameY = [...corners.map(c => c[1]), corners[0][1]];
                const frameZ = [...corners.map(c => c[2]), corners[0][2]];
                traces.push({
                    type: 'scatter3d',
                    mode: 'lines',
                    x: frameX,
                    y: frameY,
                    z: frameZ,
                    line: { color: frameColor, width: 3 },
                    name: w.id + ' frame',
                    showlegend: false,
                });
            });

            // Add plant cylinder (with offset)
            const plant = config.plant;
            const plantX = ROOM_OFFSET_X + plant.center_x;
            const plantY = ROOM_OFFSET_Y + plant.center_y;
            const nPts = 20;
            const theta = Array.from({length: nPts}, (_, i) => 2 * Math.PI * i / nPts);

            // Bottom circle
            const xBottom = theta.map(t => plantX + plant.radius * Math.cos(t));
            const yBottom = theta.map(t => plantY + plant.radius * Math.sin(t));
            const zBottom = theta.map(() => plant.z_min);

            // Top circle
            const xTop = theta.map(t => plantX + plant.radius * Math.cos(t));
            const yTop = theta.map(t => plantY + plant.radius * Math.sin(t));
            const zTop = theta.map(() => plant.z_max);

            // Combine for mesh
            const allX = [...xBottom, ...xTop];
            const allY = [...yBottom, ...yTop];
            const allZ = [...zBottom, ...zTop];

            const iIdx = [], jIdx = [], kIdx = [];
            for (let idx = 0; idx < nPts; idx++) {
                const next = (idx + 1) % nPts;
                iIdx.push(idx, next);
                jIdx.push(next, next + nPts);
                kIdx.push(idx + nPts, idx + nPts);
            }

            traces.push({
                type: 'mesh3d',
                x: allX,
                y: allY,
                z: allZ,
                i: iIdx,
                j: jIdx,
                k: kIdx,
                color: 'rgba(34, 139, 34, 0.8)',
                name: 'Plant',
                showlegend: true,
            });

            // Helper function to find ray-window intersection (with offset)
            function rayWindowIntersection(origin, direction, window) {
                // Get window normal based on wall
                const isWall1 = window.id.startsWith('window_1');
                // Wall 1 along X-axis (y=OFFSET), normal points in -Y direction
                // Wall 2 along Y-axis (x=OFFSET), normal points in -X direction
                const normal = isWall1 ? [0, -1, 0] : [-1, 0, 0];

                // Window center with offset
                const windowCenter = isWall1
                    ? [ROOM_OFFSET_X + window.center[0], ROOM_OFFSET_Y, window.center[2]]
                    : [ROOM_OFFSET_X, ROOM_OFFSET_Y + window.center[1], window.center[2]];

                const denom = direction[0]*normal[0] + direction[1]*normal[1] + direction[2]*normal[2];
                if (Math.abs(denom) < 1e-10) return null;

                const diff = [
                    windowCenter[0] - origin[0],
                    windowCenter[1] - origin[1],
                    windowCenter[2] - origin[2]
                ];
                const t = (diff[0]*normal[0] + diff[1]*normal[1] + diff[2]*normal[2]) / denom;
                if (t < 0) return null;

                return [
                    origin[0] + t * direction[0],
                    origin[1] + t * direction[1],
                    origin[2] + t * direction[2]
                ];
            }

            // Draw sun rays from far away through windows that receive sunlight
            if (result.sun_direction) {
                const sunDir = result.sun_direction;
                const sunDist = 80;
                const roomCenter = [ROOM_OFFSET_X + 8, ROOM_OFFSET_Y + 8, 5];

                // Draw rays through each window that receives sun
                config.windows.forEach((w, wIdx) => {
                    const receivesSunRay = windowReceivesSun(w.wall_normal_azimuth, sunDir);
                    if (!receivesSunRay) return;

                    const isWall1 = w.id.startsWith('window_1');

                    // Window center with offset
                    const windowCenter = isWall1
                        ? [ROOM_OFFSET_X + w.center[0], ROOM_OFFSET_Y, w.center[2]]
                        : [ROOM_OFFSET_X, ROOM_OFFSET_Y + w.center[1], w.center[2]];

                    // Calculate sun position along the ray direction from window
                    const sunStart = [
                        windowCenter[0] + sunDist * sunDir[0],
                        windowCenter[1] + sunDist * sunDir[1],
                        windowCenter[2] + sunDist * sunDir[2]
                    ];

                    // Draw ray from far away (sun) through window into room
                    // Ray continues 10m past window into room (negative sun direction)
                    const roomEnd = [
                        windowCenter[0] - 10 * sunDir[0],
                        windowCenter[1] - 10 * sunDir[1],
                        windowCenter[2] - 10 * sunDir[2]
                    ];

                    // Only draw up to floor level (z >= 0)
                    if (roomEnd[2] < 0) {
                        const t = windowCenter[2] / (windowCenter[2] - roomEnd[2]);
                        roomEnd[0] = windowCenter[0] + t * (roomEnd[0] - windowCenter[0]);
                        roomEnd[1] = windowCenter[1] + t * (roomEnd[1] - windowCenter[1]);
                        roomEnd[2] = 0;
                    }

                    // Draw the incoming ray from sun to window (bright yellow)
                    traces.push({
                        type: 'scatter3d',
                        mode: 'lines',
                        x: [sunStart[0], windowCenter[0]],
                        y: [sunStart[1], windowCenter[1]],
                        z: [sunStart[2], windowCenter[2]],
                        line: { color: 'rgba(255, 215, 0, 0.6)', width: 3 },
                        name: wIdx === 0 ? 'Sun ray (incoming)' : '',
                        showlegend: wIdx === 0,
                    });

                    // Draw ray passing through window into room (brighter)
                    traces.push({
                        type: 'scatter3d',
                        mode: 'lines',
                        x: [windowCenter[0], roomEnd[0]],
                        y: [windowCenter[1], roomEnd[1]],
                        z: [windowCenter[2], roomEnd[2]],
                        line: { color: '#FFD700', width: 4 },
                        name: wIdx === 0 ? 'Sunlight in room' : '',
                        showlegend: wIdx === 0,
                    });

                    // Mark where light enters window
                    traces.push({
                        type: 'scatter3d',
                        mode: 'markers',
                        x: [windowCenter[0]],
                        y: [windowCenter[1]],
                        z: [windowCenter[2]],
                        marker: { size: 6, color: '#FF6600', symbol: 'circle' },
                        name: '',
                        showlegend: false,
                    });
                });

                // Also draw rays to plant hit points if plant is hit
                if (result.is_hit && result.hit_points) {
                    const hitWindow = config.windows.find(w => w.id === result.window_id);

                    result.hit_points.forEach((pt, i) => {
                        if (i < 3) { // Limit rays shown
                            const ptOffset = [pt[0] + ROOM_OFFSET_X, pt[1] + ROOM_OFFSET_Y, pt[2]];

                            // Find window intersection for this ray
                            let windowPt = null;
                            if (hitWindow) {
                                windowPt = rayWindowIntersection(ptOffset, sunDir, hitWindow);
                            }

                            if (windowPt) {
                                // Draw ray from window to plant (showing light hitting plant)
                                traces.push({
                                    type: 'scatter3d',
                                    mode: 'lines',
                                    x: [windowPt[0], ptOffset[0]],
                                    y: [windowPt[1], ptOffset[1]],
                                    z: [windowPt[2], ptOffset[2]],
                                    line: { color: '#FF4500', width: 5 },
                                    name: i === 0 ? 'Ray hitting plant' : '',
                                    showlegend: i === 0,
                                });

                                // Mark hit point on plant
                                traces.push({
                                    type: 'scatter3d',
                                    mode: 'markers',
                                    x: [ptOffset[0]],
                                    y: [ptOffset[1]],
                                    z: [ptOffset[2]],
                                    marker: { size: 8, color: '#FF0000', symbol: 'diamond' },
                                    name: i === 0 ? 'Plant hit' : '',
                                    showlegend: i === 0,
                                });
                            }
                        }
                    });
                }
            }

            // Add sun indicator - far away so rays appear parallel (from "infinity")
            if (result.sun_direction) {
                const sunDir = result.sun_direction;
                // Sun very far away - rays will appear nearly parallel
                const sunDist = 80;
                const roomCenter = [ROOM_OFFSET_X + 8, ROOM_OFFSET_Y + 8, 5];
                const sunPos = [
                    roomCenter[0] + sunDist * sunDir[0],
                    roomCenter[1] + sunDist * sunDir[1],
                    Math.max(5, sunDist * sunDir[2]),
                ];

                // Sun marker (larger since it's further away)
                traces.push({
                    type: 'scatter3d',
                    mode: 'markers',
                    x: [sunPos[0]],
                    y: [sunPos[1]],
                    z: [sunPos[2]],
                    marker: { size: 25, color: '#FFD700', symbol: 'circle',
                              line: { color: '#FFA500', width: 3 } },
                    name: `Sun (El: ${result.elevation.toFixed(0)}°)`,
                    showlegend: true,
                });

                // Draw line from room center toward sun to show direction
                traces.push({
                    type: 'scatter3d',
                    mode: 'lines',
                    x: [roomCenter[0], sunPos[0]],
                    y: [roomCenter[1], sunPos[1]],
                    z: [roomCenter[2], sunPos[2]],
                    line: { color: 'rgba(255, 215, 0, 0.4)', width: 3, dash: 'dot' },
                    name: 'Sun direction',
                    showlegend: false,
                });
            }

            return traces;
        }

        function updatePlot(index) {
            const result = results[index];
            const traces = createPlotData(index);

            // Update info displays
            document.getElementById('currentTime').textContent = result.timestamp;
            document.getElementById('sunInfo').textContent =
                `Sun: Az ${result.azimuth.toFixed(0)}°, El ${result.elevation.toFixed(0)}°`;

            const statusEl = document.getElementById('statusDisplay');
            if (result.is_hit) {
                statusEl.textContent = '☀️ SUNLIGHT HITTING PLANT';
                statusEl.className = 'status hit';
                document.getElementById('windowInfo').textContent = `Through: ${result.window_id}`;
            } else {
                statusEl.textContent = 'No direct sunlight';
                statusEl.className = 'status miss';
                document.getElementById('windowInfo').textContent = '';
            }

            Plotly.react('plot3d', traces, {
                scene: {
                    xaxis: { title: 'X (meters)', range: [-30, 120] },
                    yaxis: { title: 'Y (meters)', range: [-30, 120] },
                    zaxis: { title: 'Z (meters)', range: [0, 80] },
                    aspectmode: 'cube',
                    camera: {
                        eye: { x: 1.2, y: 1.2, z: 0.7 }
                    }
                },
                title: `Sun-Plant Simulation - ${result.timestamp}`,
                showlegend: true,
                legend: { x: 0.02, y: 0.98 },
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const slider = document.getElementById('timeSlider');

            slider.addEventListener('input', function() {
                currentIndex = parseInt(this.value);
                updatePlot(currentIndex);
            });

            // Initial plot
            updatePlot(0);
        });
    </script>
</body>
</html>